#!/usr/bin/env bash
set -euo pipefail

ROOT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
ASSETS_DIR="$ROOT_DIR/internal/assets"
ARCHIVE="$ASSETS_DIR/node_modules.tar.gz"

if ! command -v npm >/dev/null 2>&1; then
  echo "npm is required to bundle node_modules" >&2
  exit 1
fi

TMP_DIR="$(mktemp -d)"
trap 'rm -rf "$TMP_DIR"' EXIT

pushd "$TMP_DIR" >/dev/null
npm install puppeteer-extra puppeteer-extra-plugin-stealth puppeteer
mkdir -p "$ASSETS_DIR"
tar -czf "$ARCHIVE" node_modules
popd >/dev/null

echo "Bundled node_modules into $ARCHIVE"
